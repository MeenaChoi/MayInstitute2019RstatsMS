<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 6 Day 2 - Section 6 : Multivariate analysis and classification | May Institute 2019: Statistics for quantitative mass spsectrometry</title>
  <meta name="description" content="Chapter 6 Day 2 - Section 6 : Multivariate analysis and classification | May Institute 2019: Statistics for quantitative mass spsectrometry">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 6 Day 2 - Section 6 : Multivariate analysis and classification | May Institute 2019: Statistics for quantitative mass spsectrometry" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Day 2 - Section 6 : Multivariate analysis and classification | May Institute 2019: Statistics for quantitative mass spsectrometry" />
  
  
  

<meta name="author" content="Meena Choi and Ting Huang">


<meta name="date" content="2019-05-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Before we start</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#suggested-reading"><i class="fa fa-check"></i>Suggested reading</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><i class="fa fa-check"></i><b>1</b> Day 1 - Section 1 : MSstats, introduction to data and preprocessing</a><ul>
<li class="chapter" data-level="1.1" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#workflow-in-msstats"><i class="fa fa-check"></i><b>1.2</b> Workflow in MSstats</a></li>
<li class="chapter" data-level="1.3" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#data"><i class="fa fa-check"></i><b>1.3</b> Data</a></li>
<li class="chapter" data-level="1.4" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#load-msstats"><i class="fa fa-check"></i><b>1.4</b> Load MSstats</a></li>
<li class="chapter" data-level="1.5" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#allowable-data-formats"><i class="fa fa-check"></i><b>1.5</b> Allowable data formats</a></li>
<li class="chapter" data-level="1.6" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#convert-to-msstats-required-format-data-cleaning"><i class="fa fa-check"></i><b>1.6</b> Convert to MSstats required format (Data cleaning)</a><ul>
<li class="chapter" data-level="1.6.1" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#skyline-output"><i class="fa fa-check"></i><b>1.6.1</b> Skyline output</a></li>
<li class="chapter" data-level="1.6.2" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#maxquant-output"><i class="fa fa-check"></i><b>1.6.2</b> MaxQuant output</a></li>
<li class="chapter" data-level="1.6.3" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#openms-output"><i class="fa fa-check"></i><b>1.6.3</b> OpenMS output</a></li>
<li class="chapter" data-level="1.6.4" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#progenesis-output"><i class="fa fa-check"></i><b>1.6.4</b> Progenesis output</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html"><a href="day-1-section-1-msstats-introduction-to-data-and-preprocessing.html#save-your-work"><i class="fa fa-check"></i><b>1.7</b> Save your work</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><i class="fa fa-check"></i><b>2</b> Day 1 - Section 2 : MSstats, Data processing - Normalization and run summarization</a><ul>
<li class="chapter" data-level="2.1" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#data-1"><i class="fa fa-check"></i><b>2.1</b> Data</a></li>
<li class="chapter" data-level="2.2" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#dataprocess-with-skyline-data"><i class="fa fa-check"></i><b>2.2</b> dataProcess with Skyline data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#load-msstats-1"><i class="fa fa-check"></i><b>2.2.1</b> Load MSstats</a></li>
<li class="chapter" data-level="2.2.2" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#load-the-pre-processed-data-of-skyline-output"><i class="fa fa-check"></i><b>2.2.2</b> Load the pre-processed data of Skyline output</a></li>
<li class="chapter" data-level="2.2.3" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#normalizing-and-summarizing-data-with-dataprocess"><i class="fa fa-check"></i><b>2.2.3</b> Normalizing and summarizing data with dataProcess</a></li>
<li class="chapter" data-level="2.2.4" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#visualization-of-processed-data"><i class="fa fa-check"></i><b>2.2.4</b> Visualization of processed data</a></li>
<li class="chapter" data-level="2.2.5" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#different-normalization-option"><i class="fa fa-check"></i><b>2.2.5</b> Different normalization option</a></li>
<li class="chapter" data-level="2.2.6" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#different-summarization-option"><i class="fa fa-check"></i><b>2.2.6</b> Different summarization option</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#dataprocess-with-maxquant-data"><i class="fa fa-check"></i><b>2.3</b> dataProcess with MaxQuant data</a></li>
<li class="chapter" data-level="2.4" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#dataprocess-with-openms-data"><i class="fa fa-check"></i><b>2.4</b> dataProcess with OpenMS data</a></li>
<li class="chapter" data-level="2.5" data-path="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html"><a href="day-1-section-2-msstats-data-processing-normalization-and-run-summarization.html#dataprocess-with-progenesis-data"><i class="fa fa-check"></i><b>2.5</b> dataProcess with Progenesis data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><i class="fa fa-check"></i><b>3</b> Day 1 - Section 3 : MSstats, Differential abundance and sample size calculation</a><ul>
<li class="chapter" data-level="3.1" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#summary"><i class="fa fa-check"></i><b>3.1</b> Summary</a></li>
<li class="chapter" data-level="3.2" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#data-2"><i class="fa fa-check"></i><b>3.2</b> Data</a></li>
<li class="chapter" data-level="3.3" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#load-msstats-2"><i class="fa fa-check"></i><b>3.3</b> Load MSstats</a></li>
<li class="chapter" data-level="3.4" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#inference-and-future-design-of-experiment-with-skyline-output"><i class="fa fa-check"></i><b>3.4</b> Inference and future design of experiment with Skyline output</a><ul>
<li class="chapter" data-level="3.4.1" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#load-the-processed-data-output-of-dataprocess-of-skyline-output"><i class="fa fa-check"></i><b>3.4.1</b> Load the processed data (output of <code>dataProcess</code>) of Skyline output</a></li>
<li class="chapter" data-level="3.4.2" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#finding-differentially-abundant-proteins-across-conditions"><i class="fa fa-check"></i><b>3.4.2</b> Finding differentially abundant proteins across conditions</a></li>
<li class="chapter" data-level="3.4.3" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#visualization-of-differentially-abundant-proteins"><i class="fa fa-check"></i><b>3.4.3</b> Visualization of differentially abundant proteins</a></li>
<li class="chapter" data-level="3.4.4" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#planning-future-experimental-designs"><i class="fa fa-check"></i><b>3.4.4</b> Planning future experimental designs</a></li>
<li class="chapter" data-level="3.4.5" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#protein-subject-quantification"><i class="fa fa-check"></i><b>3.4.5</b> Protein subject quantification</a></li>
<li class="chapter" data-level="3.4.6" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#msstats.log-and-sessioninfo.txt"><i class="fa fa-check"></i><b>3.4.6</b> msstats.log and sessionInfo.txt</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#inference-and-future-design-of-experiment-with-skyline-output-1"><i class="fa fa-check"></i><b>3.5</b> Inference and future design of experiment with Skyline output</a></li>
<li class="chapter" data-level="3.6" data-path="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html"><a href="day-1-section-3-msstats-differential-abundance-and-sample-size-calculation.html#inference-and-future-design-of-experiment-with-openms-output"><i class="fa fa-check"></i><b>3.6</b> Inference and future design of experiment with OpenMS output</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><i class="fa fa-check"></i><b>4</b> Day 2 - Section 4 : MSstatsTMT, introductioin to data and preprocessing</a><ul>
<li class="chapter" data-level="4.1" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#objective-1"><i class="fa fa-check"></i><b>4.1</b> Objective</a></li>
<li class="chapter" data-level="4.2" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#data-3"><i class="fa fa-check"></i><b>4.2</b> Data</a></li>
<li class="chapter" data-level="4.3" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#load-msstatstmt"><i class="fa fa-check"></i><b>4.3</b> Load MSstatsTMT</a></li>
<li class="chapter" data-level="4.4" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#allowable-data-formats-1"><i class="fa fa-check"></i><b>4.4</b> Allowable data formats</a></li>
<li class="chapter" data-level="4.5" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#proteome-discoverer-output"><i class="fa fa-check"></i><b>4.5</b> Proteome Discoverer output</a><ul>
<li class="chapter" data-level="4.5.1" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#read-data-4"><i class="fa fa-check"></i><b>4.5.1</b> Read data</a></li>
<li class="chapter" data-level="4.5.2" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#prepare-annotation-file"><i class="fa fa-check"></i><b>4.5.2</b> Prepare annotation file</a></li>
<li class="chapter" data-level="4.5.3" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#preprocessing-with-pdtomsstatstmtformat"><i class="fa fa-check"></i><b>4.5.3</b> Preprocessing with <code>PDtoMSstatsTMTFormat</code></a></li>
<li class="chapter" data-level="4.5.4" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#preliminary-check-2"><i class="fa fa-check"></i><b>4.5.4</b> Preliminary check</a></li>
<li class="chapter" data-level="4.5.5" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#save-your-work-1"><i class="fa fa-check"></i><b>4.5.5</b> Save your work</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#maxquant-output-1"><i class="fa fa-check"></i><b>4.6</b> MaxQuant output</a><ul>
<li class="chapter" data-level="4.6.1" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#read-data-5"><i class="fa fa-check"></i><b>4.6.1</b> Read data</a></li>
<li class="chapter" data-level="4.6.2" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#set-annotation-file-4"><i class="fa fa-check"></i><b>4.6.2</b> Set annotation file</a></li>
<li class="chapter" data-level="4.6.3" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#preprocessing-with-maxqtomsstatstmtformat"><i class="fa fa-check"></i><b>4.6.3</b> Preprocessing with <code>MaxQtoMSstatsTMTFormat</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#preliminary-check-3"><i class="fa fa-check"></i><b>4.6.4</b> Preliminary check</a></li>
<li class="chapter" data-level="4.6.5" data-path="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html"><a href="day-2-section-4-msstatstmt-introductioin-to-data-and-preprocessing.html#save-your-work-2"><i class="fa fa-check"></i><b>4.6.5</b> Save your work</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><i class="fa fa-check"></i><b>5</b> Day 2 - Section 5 : MSstatsTMT, summarization, normalization and significance analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#objective-2"><i class="fa fa-check"></i><b>5.1</b> Objective</a></li>
<li class="chapter" data-level="5.2" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#data-4"><i class="fa fa-check"></i><b>5.2</b> Data</a></li>
<li class="chapter" data-level="5.3" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#process-with-processed-pd-data"><i class="fa fa-check"></i><b>5.3</b> Process with processed PD data</a><ul>
<li class="chapter" data-level="5.3.1" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#load-the-pre-processed-data-of-pd-output"><i class="fa fa-check"></i><b>5.3.1</b> Load the pre-processed data of PD output</a></li>
<li class="chapter" data-level="5.3.2" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#normalizing-and-summarizing-data-with-proteinsummarization"><i class="fa fa-check"></i><b>5.3.2</b> Normalizing and summarizing data with proteinSummarization</a></li>
<li class="chapter" data-level="5.3.3" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#visualization-of-processed-data-1"><i class="fa fa-check"></i><b>5.3.3</b> Visualization of processed data</a></li>
<li class="chapter" data-level="5.3.4" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#different-parameter-options-for-summarization-and-normalization"><i class="fa fa-check"></i><b>5.3.4</b> Different parameter options for summarization and normalization</a></li>
<li class="chapter" data-level="5.3.5" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#finding-differentially-abundant-proteins-across-conditions-1"><i class="fa fa-check"></i><b>5.3.5</b> Finding differentially abundant proteins across conditions</a></li>
<li class="chapter" data-level="5.3.6" data-path="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html"><a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html#msstatstmt.log-and-sessioninfo.txt"><i class="fa fa-check"></i><b>5.3.6</b> msstatstmt.log and sessionInfo.txt</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html"><i class="fa fa-check"></i><b>6</b> Day 2 - Section 6 : Multivariate analysis and classification</a><ul>
<li class="chapter" data-level="6.1" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#data-5"><i class="fa fa-check"></i><b>6.1</b> Data</a></li>
<li class="chapter" data-level="6.2" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#protein-quantification"><i class="fa fa-check"></i><b>6.2</b> Protein quantification</a><ul>
<li class="chapter" data-level="6.2.1" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#read-the-protein-level-data-from-msstatstmt"><i class="fa fa-check"></i><b>6.2.1</b> Read the protein level data from MSstatsTMT</a></li>
<li class="chapter" data-level="6.2.2" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#protein-quantification-1"><i class="fa fa-check"></i><b>6.2.2</b> Protein quantification</a></li>
<li class="chapter" data-level="6.2.3" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#deal-with-missing-values"><i class="fa fa-check"></i><b>6.2.3</b> Deal with missing values</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#principal-components-analysis-pca"><i class="fa fa-check"></i><b>6.3</b> Principal components analysis (PCA)</a><ul>
<li class="chapter" data-level="6.3.1" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#pca-with-prcomp-function"><i class="fa fa-check"></i><b>6.3.1</b> PCA with <code>prcomp</code> function</a></li>
<li class="chapter" data-level="6.3.2" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#check-the-proportion-of-explained-variance"><i class="fa fa-check"></i><b>6.3.2</b> Check the proportion of explained variance</a></li>
<li class="chapter" data-level="6.3.3" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#visualization-for-pc1-vs-pc2"><i class="fa fa-check"></i><b>6.3.3</b> Visualization for PC1 vs PC2</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#heatmap"><i class="fa fa-check"></i><b>6.4</b> Heatmap</a><ul>
<li class="chapter" data-level="6.4.1" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#matrix-format"><i class="fa fa-check"></i><b>6.4.1</b> matrix format</a></li>
<li class="chapter" data-level="6.4.2" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#heatmap-function-in-base-stats-package"><i class="fa fa-check"></i><b>6.4.2</b> <code>heatmap</code> function in base <code>stats</code> package</a></li>
<li class="chapter" data-level="6.4.3" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#color-bar-for-group-information"><i class="fa fa-check"></i><b>6.4.3</b> Color bar for group information</a></li>
<li class="chapter" data-level="6.4.4" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#different-distance-and-clustering"><i class="fa fa-check"></i><b>6.4.4</b> Different distance and clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#classification"><i class="fa fa-check"></i><b>6.5</b> Classification</a><ul>
<li class="chapter" data-level="6.5.1" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#training-random-forest-with-all-the-proteins"><i class="fa fa-check"></i><b>6.5.1</b> Training random forest with all the proteins</a></li>
<li class="chapter" data-level="6.5.2" data-path="day-2-section-6-multivariate-analysis-and-classification.html"><a href="day-2-section-6-multivariate-analysis-and-classification.html#predict-validation-cohort"><i class="fa fa-check"></i><b>6.5.2</b> Predict validation cohort</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">May Institute 2019: Statistics for quantitative mass spsectrometry</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="day-2---section-6-multivariate-analysis-and-classification" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Day 2 - Section 6 : Multivariate analysis and classification</h1>
<div id="data-5" class="section level2">
<h2><span class="header-section-number">6.1</span> Data</h2>
<ul>
<li>The protein-level data <code>quant.pd.rda</code> from section 5.</li>
</ul>
<hr />
</div>
<div id="protein-quantification" class="section level2">
<h2><span class="header-section-number">6.2</span> Protein quantification</h2>
<div id="read-the-protein-level-data-from-msstatstmt" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Read the protein level data from MSstatsTMT</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
<span class="kw">library</span>(dplyr)

<span class="co"># load data</span>
<span class="kw">load</span>(<span class="st">&#39;data/data_ProteomeDiscoverer_TMT/quant.pd.rda&#39;</span>)

<span class="co"># Pretend the two replicates within each condition and mixture are biological replicate</span>
quant.pd &lt;-<span class="st"> </span>quant.pd <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">BioReplicate =</span> <span class="kw">paste</span>(Mixture, Channel, <span class="dt">sep=</span><span class="st">&quot;_&quot;</span>))</code></pre>
</div>
<div id="protein-quantification-1" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Protein quantification</h3>
<p>We should first get subject quantification for each protein.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># protein quantification per subject</span>
<span class="kw">head</span>(quant.pd)

<span class="co"># use technical replicate 2 and 3 as training data</span>
quant.pd.per.subject &lt;-<span class="st"> </span>quant.pd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(TechRepMixture <span class="op">!=</span><span class="st"> &quot;1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(Protein, BioReplicate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Abundance =</span> <span class="kw">median</span>(Abundance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(BioReplicate, Abundance)

train_abun &lt;-<span class="st"> </span>quant.pd.per.subject
<span class="kw">colnames</span>(train_abun)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make protein abundance matrix</span>
proteins &lt;-<span class="st"> </span>train_abun<span class="op">$</span>Protein
train_abun &lt;-<span class="st"> </span>train_abun[, <span class="dv">-1</span>]
train_abun &lt;-<span class="st"> </span><span class="kw">t</span>(train_abun)
<span class="kw">colnames</span>(train_abun) &lt;-<span class="st"> </span>proteins
<span class="kw">dim</span>(train_abun) <span class="co"># there are 50 rows (each row for subject) and 50 columns (one column per protein)</span></code></pre>
<pre><code>## [1] 50 50</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get annotation information</span>
<span class="kw">colnames</span>(quant.pd)</code></pre>
<pre><code>## [1] &quot;Run&quot;            &quot;Protein&quot;        &quot;Abundance&quot;      &quot;Channel&quot;       
## [5] &quot;BioReplicate&quot;   &quot;Condition&quot;      &quot;TechRepMixture&quot; &quot;Mixture&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">train_anno &lt;-<span class="st"> </span>quant.pd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BioReplicate, Condition)
train_anno &lt;-<span class="st"> </span><span class="kw">unique</span>(train_anno)
train_anno &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(train_anno)
<span class="kw">dim</span>(train_anno) <span class="co"># there are 50 rows (each row for subject)</span></code></pre>
<pre><code>## [1] 50  2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">## remove the normalization channels</span>
train_abun &lt;-<span class="st"> </span>train_abun[train_anno<span class="op">$</span>Condition <span class="op">!=</span><span class="st"> &quot;Norm&quot;</span>,]
train_anno &lt;-<span class="st"> </span>train_anno[train_anno<span class="op">$</span>Condition <span class="op">!=</span><span class="st"> &quot;Norm&quot;</span>,]</code></pre>
</div>
<div id="deal-with-missing-values" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Deal with missing values</h3>
<p>Please check whether there are missing values (NAs) or not. If there is no intensity at all in certain subject for certain protein, we can’t get subject-summarized for that run.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(<span class="kw">is.na</span>(train_abun))</code></pre>
<pre><code>## [1] 29</code></pre>
<p>There are three NAs. Then, we need to decide how to deal with NAs.
* First option: remove the samples with missing values
* Second option: impute the missing values. Such as 1) with minimum value per protein or among all proteins, 2) with median or mean.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First option: remove the samples with missing values</span>
<span class="kw">dim</span>(<span class="kw">na.omit</span>(train_abun))</code></pre>
<pre><code>## [1] 22 50</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Second option: impute the missing values with miminal value</span>
random.imp &lt;-<span class="st"> </span><span class="cf">function</span> (a){
  missing &lt;-<span class="st"> </span><span class="kw">is.na</span>(a)
  n.missing &lt;-<span class="st"> </span><span class="kw">sum</span>(missing)
  a.obs &lt;-<span class="st"> </span>a[<span class="op">!</span>missing]
  imputed &lt;-<span class="st"> </span>a
  <span class="co"># imputed[missing] &lt;- 0 # with zero</span>
  <span class="co"># imputed[missing] &lt;- median(a.obs) # with median values</span>
  imputed[missing] &lt;-<span class="st"> </span><span class="kw">min</span>(a.obs) <span class="co"># with minimal values</span>
  <span class="kw">return</span> (imputed)
}

pMiss &lt;-<span class="st"> </span><span class="cf">function</span>(x){
  <span class="kw">sum</span>(<span class="kw">is.na</span>(x))<span class="op">/</span><span class="kw">length</span>(x)<span class="op">*</span><span class="dv">100</span>
}</code></pre>
<div id="only-keep-the-subjects-with-less-than-5-missing-values" class="section level4">
<h4><span class="header-section-number">6.2.3.1</span> Only keep the subjects with less than 5% missing values</h4>
<pre class="sourceCode r"><code class="sourceCode r">subjectmissing &lt;-<span class="st"> </span><span class="kw">apply</span>(train_abun, <span class="dv">1</span>, pMiss)
train_abun &lt;-<span class="st"> </span>train_abun[subjectmissing <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>, ]
<span class="kw">dim</span>(train_abun)</code></pre>
<pre><code>## [1] 37 50</code></pre>
</div>
<div id="impute-the-missing-values" class="section level4">
<h4><span class="header-section-number">6.2.3.2</span> Impute the missing values</h4>
<p>In this case, let’s impute the missing values with minimum value per protein.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make sure the subject order in train_abun and train_anno consistent</span>
train_anno &lt;-<span class="st"> </span>train_anno[train_anno<span class="op">$</span>BioReplicate <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(train_abun),] <span class="co">#remvoe the filtered subjects</span>
train_abun &lt;-<span class="st"> </span>train_abun[train_anno<span class="op">$</span>BioReplicate,]

imputed_train_abun &lt;-<span class="st"> </span><span class="kw">apply</span>(train_abun, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">random.imp</span>(x))
imputed_train_abun &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(imputed_train_abun)

<span class="kw">sum</span>(<span class="kw">is.na</span>(imputed_train_abun))</code></pre>
<pre><code>## [1] 0</code></pre>
<hr />
</div>
</div>
</div>
<div id="principal-components-analysis-pca" class="section level2">
<h2><span class="header-section-number">6.3</span> Principal components analysis (PCA)</h2>
<div id="pca-with-prcomp-function" class="section level3">
<h3><span class="header-section-number">6.3.1</span> PCA with <code>prcomp</code> function</h3>
<p>Input has the row for run (subject) and the column for proteins.</p>
<pre class="sourceCode r"><code class="sourceCode r">?prcomp
<span class="co"># rows are proteins and columns are subjects</span>
pc &lt;-<span class="st"> </span><span class="kw">prcomp</span>(imputed_train_abun)

<span class="co"># Inspect PCA object</span>
<span class="kw">summary</span>(pc)</code></pre>
<pre><code>## Importance of components:
##                           PC1     PC2     PC3     PC4     PC5    PC6
## Standard deviation     2.6934 0.96718 0.52218 0.44114 0.41603 0.3419
## Proportion of Variance 0.7571 0.09762 0.02846 0.02031 0.01806 0.0122
## Cumulative Proportion  0.7571 0.85473 0.88318 0.90349 0.92155 0.9337
##                            PC7     PC8     PC9    PC10    PC11    PC12
## Standard deviation     0.31467 0.28257 0.26482 0.22441 0.22257 0.21286
## Proportion of Variance 0.01033 0.00833 0.00732 0.00526 0.00517 0.00473
## Cumulative Proportion  0.94408 0.95242 0.95974 0.96499 0.97016 0.97489
##                          PC13    PC14    PC15    PC16    PC17    PC18
## Standard deviation     0.1958 0.18588 0.16430 0.14277 0.13591 0.12553
## Proportion of Variance 0.0040 0.00361 0.00282 0.00213 0.00193 0.00164
## Cumulative Proportion  0.9789 0.98250 0.98532 0.98744 0.98937 0.99101
##                           PC19    PC20    PC21    PC22    PC23    PC24
## Standard deviation     0.12073 0.10874 0.10459 0.09577 0.08881 0.08152
## Proportion of Variance 0.00152 0.00123 0.00114 0.00096 0.00082 0.00069
## Cumulative Proportion  0.99254 0.99377 0.99491 0.99587 0.99669 0.99739
##                           PC25    PC26    PC27    PC28    PC29    PC30
## Standard deviation     0.07513 0.07431 0.06282 0.05512 0.05117 0.04461
## Proportion of Variance 0.00059 0.00058 0.00041 0.00032 0.00027 0.00021
## Cumulative Proportion  0.99797 0.99855 0.99896 0.99928 0.99955 0.99976
##                           PC31    PC32      PC33
## Standard deviation     0.04000 0.02629 2.325e-15
## Proportion of Variance 0.00017 0.00007 0.000e+00
## Cumulative Proportion  0.99993 1.00000 1.000e+00</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(pc)</code></pre>
<pre><code>## [1] &quot;sdev&quot;     &quot;rotation&quot; &quot;center&quot;   &quot;scale&quot;    &quot;x&quot;</code></pre>
</div>
<div id="check-the-proportion-of-explained-variance" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Check the proportion of explained variance</h3>
<p>Let’s check the proportion of explained variance. The first component has the largest variance. In this case, we need 2 components to capture most of the variation.</p>
<pre class="sourceCode r"><code class="sourceCode r">percent_var &lt;-<span class="st"> </span>pc<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="kw">sum</span>(pc<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span>)
<span class="kw">barplot</span>(percent_var, <span class="dt">xlab=</span><span class="st">&quot;Principle component&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;% of variance&quot;</span>)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r">cum_var &lt;-<span class="st"> </span><span class="kw">cumsum</span>(pc<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span><span class="op">/</span><span class="kw">sum</span>(pc<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span>))
<span class="kw">barplot</span>(cum_var, <span class="dt">xlab=</span><span class="st">&quot;Principle component&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Cumulative % of variance&quot;</span> )</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
</div>
<div id="visualization-for-pc1-vs-pc2" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Visualization for PC1 vs PC2</h3>
<p>Let’s visualize PC1 vs PC2 in scatterplot. ‘x’ include PC components for each subject.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># head(pc$x)</span>
<span class="kw">library</span>(ggplot2)

<span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>PC1, <span class="dt">y=</span>PC2), <span class="dt">data=</span><span class="kw">data.frame</span>(pc<span class="op">$</span>x))<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>In order to distinguish group by colors or shape, add Group informtion to ggplot. The order should be the same as column of input.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(train_anno)</code></pre>
<pre><code>##    BioReplicate Condition
## 1 Mixture1_127C     0.125
## 2 Mixture1_129N     0.125
## 3 Mixture1_128N       0.5
## 4 Mixture1_129C       0.5
## 5 Mixture1_127N     0.667
## 6 Mixture1_130C     0.667</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create PC1 vs PC2 scatterplot with Condition colors</span>
<span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>PC1, <span class="dt">y=</span>PC2, <span class="dt">color=</span>Condition), <span class="dt">data=</span><span class="kw">data.frame</span>(pc<span class="op">$</span>x, <span class="dt">Condition=</span>train_anno<span class="op">$</span>Condition))<span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">4</span>, <span class="dt">alpha=</span><span class="fl">0.5</span>)<span class="op">+</span>
<span class="st">    </span><span class="kw">theme_bw</span>()</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="heatmap" class="section level2">
<h2><span class="header-section-number">6.4</span> Heatmap</h2>
<div id="matrix-format" class="section level3">
<h3><span class="header-section-number">6.4.1</span> matrix format</h3>
<pre class="sourceCode r"><code class="sourceCode r">ht.data &lt;-<span class="st"> </span><span class="kw">t</span>(imputed_train_abun)
<span class="co"># check the class</span>
<span class="kw">class</span>(ht.data)</code></pre>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
</div>
<div id="heatmap-function-in-base-stats-package" class="section level3">
<h3><span class="header-section-number">6.4.2</span> <code>heatmap</code> function in base <code>stats</code> package</h3>
<p>First, let’s try to draw heatmap with base function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Change the font of row and column label</span>
<span class="kw">heatmap</span>(ht.data, <span class="dt">cexRow =</span> <span class="fl">0.3</span>, <span class="dt">cexCol =</span> <span class="fl">0.4</span>)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(marray)</code></pre>
<pre><code>## Loading required package: limma</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">my.colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">maPalette</span>(<span class="dt">low =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">k =</span> <span class="dv">7</span>)[<span class="op">-</span><span class="dv">7</span>],
               <span class="st">&quot;white&quot;</span>, 
               <span class="kw">maPalette</span>(<span class="dt">low =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;darkred&quot;</span>, <span class="dt">k =</span> <span class="dv">7</span>)[<span class="op">-</span><span class="dv">1</span>])

<span class="kw">heatmap</span>(ht.data, <span class="dt">cexRow =</span> <span class="fl">0.3</span>, <span class="dt">cexCol =</span> <span class="fl">0.4</span>, <span class="dt">col =</span> my.colors)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Don&#39;t do cluster on rows</span>
<span class="kw">heatmap</span>(ht.data, <span class="dt">cexRow =</span> <span class="fl">0.3</span>, <span class="dt">cexCol =</span> <span class="fl">0.4</span>, <span class="dt">col =</span> my.colors, <span class="dt">Rowv =</span> <span class="ot">NA</span>)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-13-3.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Don&#39;t do cluster on columns</span>
<span class="kw">heatmap</span>(ht.data, <span class="dt">cexRow =</span> <span class="fl">0.3</span>, <span class="dt">cexCol =</span> <span class="fl">0.4</span>, <span class="dt">col =</span> my.colors, <span class="dt">Colv =</span> <span class="ot">NA</span>)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-13-4.png" width="672" /></p>
</div>
<div id="color-bar-for-group-information" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Color bar for group information</h3>
<p>Add color side bar at th top of columns to distinguish group information by run.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(train_anno<span class="op">$</span>Condition)</code></pre>
<pre><code>## [1] 0.125 0.5   0.667 1    
## Levels: 0.125 0.5 0.667 1 Norm</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">group.color &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;blue&quot;</span>, <span class="kw">nrow</span>(imputed_train_abun))
group.color[train_anno<span class="op">$</span>Condition <span class="op">==</span><span class="st"> &quot;1&quot;</span>] &lt;-<span class="st"> &quot;red&quot;</span> 
group.color[train_anno<span class="op">$</span>Condition <span class="op">==</span><span class="st"> &quot;0.667&quot;</span>] &lt;-<span class="st"> &quot;yellow&quot;</span> 
group.color[train_anno<span class="op">$</span>Condition <span class="op">==</span><span class="st"> &quot;0.5&quot;</span>] &lt;-<span class="st"> &quot;orange&quot;</span> 
<span class="kw">heatmap</span>(ht.data, <span class="dt">ColSideColors=</span>group.color, <span class="dt">col =</span> my.colors, <span class="dt">cexRow =</span> <span class="fl">0.3</span>, <span class="dt">cexCol =</span> <span class="fl">0.4</span>, <span class="dt">Rowv =</span> <span class="ot">NA</span>)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="different-distance-and-clustering" class="section level3">
<h3><span class="header-section-number">6.4.4</span> Different distance and clustering</h3>
<p>Try different distances calculation and clustering methods. Choice of distance metric or clustering matters!</p>
<ul>
<li><p>Distance options: euclidean (default), maximum, canberra, binary, minkowski, manhattan</p></li>
<li><p>Cluster options: complete (default), single, average, mcquitty, median, centroid, ward</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># can change method for distance calculation</span>
col_distance &lt;-<span class="st"> </span><span class="kw">dist</span>(<span class="kw">t</span>(ht.data), <span class="dt">method =</span> <span class="st">&quot;euclidean&quot;</span>)
<span class="co"># can change clustering method</span>
col_cluster &lt;-<span class="st"> </span><span class="kw">hclust</span>(col_distance, <span class="dt">method =</span> <span class="st">&quot;ward.D&quot;</span>)

<span class="kw">heatmap</span>(ht.data,
        <span class="dt">cexRow =</span> <span class="fl">0.3</span>, <span class="dt">cexCol =</span> <span class="fl">0.4</span>, <span class="dt">Rowv =</span> <span class="ot">NA</span>, 
        <span class="dt">ColSideColors =</span> group.color,
        <span class="dt">col =</span> my.colors,
        <span class="dt">Colv =</span> <span class="kw">as.dendrogram</span>(col_cluster)) </code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<hr />
</div>
</div>
<div id="classification" class="section level2">
<h2><span class="header-section-number">6.5</span> Classification</h2>
<div id="training-random-forest-with-all-the-proteins" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Training random forest with all the proteins</h3>
<p>Random Forest algorithm can be used for both classification and regression applications. In this tutorial, we will only focus random forest using R for binary classification example.</p>
<p>Random Forest algorithm is built in <strong>randomForest</strong> package of R and same name function allows us to use the Random Forest in R.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set random seed to make results reproducible:</span>
<span class="kw">set.seed</span>(<span class="dv">430</span>)
<span class="co">#install.packages(&quot;randomForest&quot;)</span>
<span class="co"># Load library</span>
<span class="kw">library</span>(randomForest)
?randomForest</code></pre>
<p>Some of the commonly used parameters of randomForest functions are</p>
<ul>
<li><p><code>formula</code> : Random Forest Formula</p></li>
<li><p><code>data</code>: Input data frame</p></li>
<li><p><code>ntree</code>: Number of decision trees to be grown. Larger the tree, it will be more computationally expensive to build models.</p></li>
<li><p><code>mtry</code>: It refers to how many variables we should select at a node split. Also as mentioned above, the default value is p/3 for regression and sqrt(p) for classification. We should always try to avoid using smaller values of mtry to avoid overfitting.</p></li>
<li><p><code>nodesize</code>: nodesize - It refers to how many observations we want in the terminal nodes. This parameter is directly related to tree depth. Higher the number, lower the tree depth. With lower tree depth, the tree might even fail to recognize useful signals from the data. Defaut is 1 for classification.</p></li>
<li><p><code>importance</code>: Whether independent variable importance in random forest be assessed</p></li>
</ul>
<p>Mainly, there are three parameters in the random forest algorithm which you should look at (for tuning): <code>ntree</code>, <code>mtry</code> and <code>nodesize</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add group information to the training data</span>
imputed_train_abun<span class="op">$</span>Condition &lt;-<span class="st"> </span><span class="kw">droplevels</span>(train_anno<span class="op">$</span>Condition)

<span class="co"># randomForest dosen&#39;t allow special symbol in the protein name</span>
<span class="kw">colnames</span>(imputed_train_abun) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">colnames</span>(imputed_train_abun))

<span class="co"># fit random forest</span>
rf=<span class="kw">randomForest</span>(Condition <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> imputed_train_abun, <span class="dt">importance=</span><span class="ot">TRUE</span>)
rf</code></pre>
<pre><code>## 
## Call:
##  randomForest(formula = Condition ~ ., data = imputed_train_abun,      importance = TRUE) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 7
## 
##         OOB estimate of  error rate: 0%
## Confusion matrix:
##       0.125 0.5 0.667 1 class.error
## 0.125     8   0     0 0           0
## 0.5       0   8     0 0           0
## 0.667     0   0     9 0           0
## 1         0   0     0 8           0</code></pre>
<p>Variable importance plot is also a useful tool and can be plotted using varImpPlot function. Top 10 proteins are selected and plotted based on Model Accuracy and Gini value. We can also get a table with decreasing order of importance based on a measure (1 for model accuracy and 2 node impurity)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot importance of protiens</span>
<span class="kw">varImpPlot</span>(rf, <span class="dt">sort =</span> T, 
           <span class="dt">main=</span><span class="st">&quot;Variable Importance&quot;</span>,
           <span class="dt">n.var=</span><span class="dv">10</span>)</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># store the importance of proteins </span>
var.imp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">importance</span>(rf,
                                 <span class="dt">type=</span><span class="dv">2</span>))
<span class="co"># make row names as columns</span>
var.imp<span class="op">$</span>Variables &lt;-<span class="st"> </span><span class="kw">row.names</span>(var.imp)
<span class="co"># order the proteins based on their importance</span>
var.imp &lt;-<span class="st"> </span>var.imp[<span class="kw">order</span>(var.imp<span class="op">$</span>MeanDecreaseGini,<span class="dt">decreasing =</span> T),]

<span class="co"># select top 10 proteins</span>
biomarkers &lt;-<span class="st"> </span><span class="kw">rownames</span>(var.imp)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]
biomarkers</code></pre>
<pre><code>##  [1] &quot;P02788ups&quot;  &quot;P106368ups&quot; &quot;P02787ups&quot;  &quot;P02144ups&quot;  &quot;P00915ups&quot; 
##  [6] &quot;P68871ups&quot;  &quot;P01344ups&quot;  &quot;P01375ups&quot;  &quot;P01008ups&quot;  &quot;P05413ups&quot;</code></pre>
</div>
<div id="predict-validation-cohort" class="section level3">
<h3><span class="header-section-number">6.5.2</span> Predict validation cohort</h3>
<pre class="sourceCode r"><code class="sourceCode r">valid_abun &lt;-<span class="st"> </span>quant.pd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(TechRepMixture <span class="op">==</span><span class="st"> &quot;1&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Protein, BioReplicate, Abundance) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(BioReplicate, Abundance)

<span class="co"># make protein abundance matrix</span>
proteins &lt;-<span class="st"> </span>valid_abun<span class="op">$</span>Protein
valid_abun &lt;-<span class="st"> </span>valid_abun[, <span class="dv">-1</span>]
valid_abun &lt;-<span class="st"> </span><span class="kw">t</span>(valid_abun)
<span class="kw">colnames</span>(valid_abun) &lt;-<span class="st"> </span>proteins
<span class="kw">dim</span>(valid_abun) <span class="co"># there are 50 rows (each row for subject) and 50 columns (one column per protein)</span></code></pre>
<pre><code>## [1] 50 50</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get annotation information</span>
<span class="kw">colnames</span>(quant.pd)</code></pre>
<pre><code>## [1] &quot;Run&quot;            &quot;Protein&quot;        &quot;Abundance&quot;      &quot;Channel&quot;       
## [5] &quot;BioReplicate&quot;   &quot;Condition&quot;      &quot;TechRepMixture&quot; &quot;Mixture&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">valid_anno &lt;-<span class="st"> </span>quant.pd <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(BioReplicate, Condition)
valid_anno &lt;-<span class="st"> </span><span class="kw">unique</span>(valid_anno)
valid_anno &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(valid_anno)
<span class="kw">dim</span>(valid_anno) <span class="co"># there are 50 rows (each row for subject)</span></code></pre>
<pre><code>## [1] 50  2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">valid_abun &lt;-<span class="st"> </span>valid_abun[valid_anno<span class="op">$</span>BioReplicate,]
<span class="co">## remove the normalization channels</span>
valid_abun &lt;-<span class="st"> </span>valid_abun[valid_anno<span class="op">$</span>Condition <span class="op">!=</span><span class="st"> &quot;Norm&quot;</span>,]
valid_anno &lt;-<span class="st"> </span>valid_anno[valid_anno<span class="op">$</span>Condition <span class="op">!=</span><span class="st"> &quot;Norm&quot;</span>,]

imputed_valid_abun &lt;-<span class="st"> </span><span class="kw">apply</span>(valid_abun, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">random.imp</span>(x))
imputed_valid_abun &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(imputed_valid_abun)
<span class="co"># randomForest dosen&#39;t allow special symbol in the protein name</span>
<span class="kw">colnames</span>(imputed_valid_abun) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">colnames</span>(imputed_valid_abun))

<span class="co"># prediction on validation set</span>
valid_anno<span class="op">$</span>Condition &lt;-<span class="st"> </span><span class="kw">droplevels</span>(valid_anno<span class="op">$</span>Condition)
valid_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(rf, imputed_valid_abun)

<span class="co"># Validation set assessment #1: looking at confusion matrix</span>
<span class="kw">table</span>(<span class="dt">data=</span>valid_pred,
      <span class="dt">reference=</span>valid_anno<span class="op">$</span>Condition)</code></pre>
<pre><code>##        reference
## data    0.125 0.5 0.667  1
##   0.125    10   0     0  0
##   0.5       0  10     2  0
##   0.667     0   0     8  0
##   1         0   0     0 10</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate the predictive accuracy</span>
misClasificError &lt;-<span class="st"> </span><span class="kw">mean</span>(valid_pred <span class="op">!=</span><span class="st"> </span>valid_anno<span class="op">$</span>Condition)
<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;Accuracy&#39;</span>,<span class="dv">1</span><span class="op">-</span>misClasificError))</code></pre>
<pre><code>## [1] &quot;Accuracy 0.95&quot;</code></pre>
<p>The confusion matrix is a good way of looking at how good our classifier is performing when presented with new data.</p>
<hr />

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="day-2-section-5-msstatstmt-summarization-normalization-and-significance-analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/MayInst_P6_day2_sec6.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
